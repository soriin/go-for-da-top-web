<link rel="import" href="./fetchRequest.html">
<link rel="import" href="../vendor/moment.html">

<dom-module id="gfdt-tournament-service">
  <script>
    class TournamentService {
      getAll(startDate, endDate) {
        const queryParams = {}
        const momentStart = moment(startDate)
        const momentEnd = moment(endDate)
        if (startDate && momentStart.isValid()) {
          queryParams.startDate = momentStart.toDate()
        }
        if (endDate && momentEnd.isValid()) {
          queryParams.endDate = momentEnd.toDate()
        }
        const req = createRequest('tournaments', {}, queryParams)
        return fetch(req)
      }

      create(data) {
        let payload
        if (typeof(data) === 'object') {
          payload = JSON.stringify(data)
        } else {
          payload = data
        }
        const req = createRequest('tournaments', {method: 'POST', body: payload})
        return fetch (req)
      }

      join(tournamentId) {
        const req = createRequest(`tournaments/${tournamentId}/entrant`, {method: 'POST'})
        return fetch (req)
      }

      activate(tournamentId) {
        const req = createRequest(`tournaments/${tournamentId}/activation`, {method: 'POST'})
        return fetch (req)
      }

      leave(tournamentId) {
        const req = createRequest(`tournaments/${tournamentId}/entrant`, {method: 'DELETE'})
        return fetch (req)
      }
    }
  </script>
</dom-module>