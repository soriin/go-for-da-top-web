<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="../reduxMixin.html">
<link rel="import" href="../services/matchupService.html">
<link rel="import" href="./matchup-list-item.html">
<link rel="import" href="./battle.html">
<link rel="import" href="./battle-submission-form.html">

<dom-module id="gfdt-matchup-dashboard">
  <template>
    <style include="shared-styles">
      gfdt-matchup-list-item {
        padding: 20px;
      }
    </style>

    <div>
      <template is="dom-if" if="[[selectedBattle]]">
        <template is="dom-if" if="[[selectedMatchup.verification]]">
          <gfdt-battle></gfdt-battle>
        </template>
        <template is="dom-if" if="[[!selectedMatchup.verification]]">
          <gfdt-battle-submission-form></gfdt-battle-submission-form>
        </template>
      </template>
    </div>
    <div hidden$="[[selectedBattle]]">
      <template is="dom-repeat" items="[[matchups]]" as="matchup">
        <gfdt-matchup-list-item matchup="[[matchup]]"></gfdt-matchup-list-item>
      </template>
    </div>

  </template>
  <script>
    class MatchupDashboard extends FormatterMixin(ReduxMixin(Polymer.Element)) {
      constructor() {
        super()
        this.matchupService = new MatchupService()
        //this.permissionHelper = new PermissionHelper()
      }

      ready() {
        super.ready()
        this.refreshMine()
      }

      async refreshMine() {
        try {
          const response = await this.matchupService.getMine()
          if (response.ok) {
            const data = await response.json()
            this.dispatch('updateMatchups', data.matchups)
          }
        } catch (e) {
          console.error('error activating tournaments', e)
        }
      }

      static get is() { return 'gfdt-matchup-dashboard'; }
      static get actions() {
        return {
          updateMatchups(matchups) {
            return {
              matchups,
              type: 'updateMatchups'
            }
          },
        }
      }
      static get properties() {
        return {
          matchups: {
            type: Array,
            statePath: 'matchups'
          },
          selectedBattle: {
            type: Object,
            statePath: 'selectedBattle'
          },
          selectedMatchup: {
            type: Object,
            statePath: 'selectedMatchup'
          }
        }
      }

      static get observers() {
        return [
        ]
      }
    }
    window.customElements.define(MatchupDashboard.is, MatchupDashboard)
  </script>
</dom-module>